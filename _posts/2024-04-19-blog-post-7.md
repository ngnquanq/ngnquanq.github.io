---
title: 'Paper Explained 6: Learning Diverse Image Colorization'
date: 2024-04-19
permalink: /posts/2024/04/blog-post-7/
tags:
  - Paper explained
published: true
---

**Image Colorization** 🖌️ là quá trình dự đoán màu cho các ảnh đen trắng, giúp tái tạo lại hình ảnh thực
tế từ dữ liệu đơn sắc, mang lại trải nghiệm hình ảnh phong phú và sống động. Với đầu vào là một ảnh
xám, biểu thị cường độ sáng của ảnh, mô hình sẽ học cách ước tính các kênh màu của ảnh, tạo ra một
hình ảnh hợp lý và hài hòa về mặt thị giác. Một trong những bài mà mình được học về chủ đề này đó là bài "Learning Diverse Image Colorization", mọi người có thể đọc ở [đây](https://arxiv.org/pdf/1612.01958.pdf)

# Giới thiệu

Task tô màu ảnh thoạt qua nghe hơi nhảm (mình thấy vậy 😐), nhưng thật ra có nhiều ứng dụng cho đời sống hàng ngày của chúng ta, sơ sơ qua thì nó có thể làm cho những ảnh trắng đen trong quá khứ có màu sắc hơn, đối với lĩnh vực ML&DL thì cũng có thể coi như việc tô màu là một cách để chúng ta tăng cường số lượng dữ liệu hiện có (data augmentation) thậm chí ở những lĩnh vực như y khoa cũng sử dụng tới, như là để tăng cường cái sắc độ, giúp cho các bác sĩ nhìn vào dễ chuẩn đoán hơn, và nhiều nhiều cái khác. Thì cụ thể hơn, bài toán tô màu ảnh mình nhắc đến trong bài này là như sau:

![img_color](/assets/img/blog6/img_color.png){: .align-center}

Song, đây vẫn là một vấn đề không dễ đễ tiếp cận, bởi vì có rất nhiều cách để sinh ra nhiều màu khác nhau từ một tấm ảnh trắng đen, quan trọng ở đây là **màu được tô có nghĩa**, và ngoài ra, theo như paper (viết vào năm 2017), tại thời điểm đó, các phương pháp tô màu ảnh còn chưa được tốt cho lắm, bởi vì tại thời điểm đó, các phương pháp cũ chỉ đưa ra được gần như là 1 kết quả duy nhất (tức là chỉ có 1 tấm ảnh màu, nó không đa dạng lắm). 

Với cái vấn đề như trên, **goal của paper này là thiết kế ra một model có khả năng đa dạng ảnh tô được tô màu hơn (nhưng màu tô vẫn phải hợp lý)**

Cái hình dưới đây mình bê từ cái paper ra, họ làm trên bộ dữ liệu LFW ([Labeled Faces in the Wild](https://vis-www.cs.umass.edu/lfw/))

![result-img](/assets/img/blog6/result-paper.png)

Ví dụ như mấy cái hình này của người ta, nó đa dạng hơn hẳn những cái model sẵn có thời bấy giờ, và mọi người lưu ý thêm là sẽ **có khả năng rất cao những sample được tạo ra không giống ground truth**, nhưng **đây không phải vấn đề**, mình sẽ đề cập kĩ hơn ở những phần sau.

#### References: 
- Labeled Faces in the Wild - https://vis-www.cs.umass.edu/lfw/
- Learning Diverse Image Colorization - https://arxiv.org/pdf/1612.01958.pdf

# Ý tưởng 
Những bài toán tô màu ảnh có điểm chung trong code đó chính là chúng ta sẽ có một **input là ảnh trắng đen (grey-level image)** và **output là một trường 2 kênh màu** thông qua một hàm ánh xạ nào đó. Như đề cập ở trên thì sẽ **có vô số ảnh màu khác nhau cho cùng một ảnh đen trắng**. Khác nhau ở đây có chăng là ở cường độ của màu dự đoán, ví dụ như một cái sẽ có màu trời đậm hơn, cái còn lại có ảnh màu trời nhạt hơn, v.v... Nghe thì như vậy, những phương pháp deep learning tại thời điểm đó có vẻ không được chuộng cho lắm, song dù sao, objective của bài nghiên cứu này là **tạo ra nhiều hình ảnh đa dạng màu sắc, đồng thời có ý nghĩa**. 

Vấn đề nằm ở chỗ **một trường màu nào đó không chỉ phụ thuộc vào những giá trị lân cận, nó còn chịu ảnh hưởng bởi cấu trúc không gian (long-scale spatial structure)**, điều này khiến cho việc sampling chỉ duy nhất 1 điểm ảnh sẽ làm cho khu vực lân cận điểm ảnh đó không được ăn khớp với nhau, làm cho hình ảnh không được thực tế. Giải pháp là **tạo ra được nhiều màu khác nhau nhưng phải cân bằng được giữa ước lượng của điểm ảnh đó với cái cấu trúc không gian ảnh**. 

## Ý tưởng mô hình

Những cái ở trên đề cập có thể tái hiện dưới công thức toán, mô hình chúng ta mong muốn sẽ là một mô hình xác suất $P(\mathbf{C|G})$ cho trường màu $C$ dựa trên ảnh xám đầu vào $G$ và sau đó để tạo ra, chẳng hạn N màu khác nhau đi, lúc này chúng ta sẽ thực hiện lấy mẫu có từ phân phối xác suất vừa đề cập ở trên: 

$$
\begin{equation}
\{\mathbf{C}_k\}_{k=1}^{N} \sim P(\mathbf{C|G})
\end{equation}
$$

Nhưng do những cái ảnh thường có số chiều rất cao, do đó phân phối của các trường ảnh trong tự nhiên và những đặc trưng của ảnh trắng đen trong không gian nhiều chiều bị phân tán. Hiểu đơn giản đây là một trong những hiện tiện của dữ liệu nhiều chiều, khi này khoảng cách của 2 điểm dữ liệu bất kỳ không còn nhiều ý nghĩa khi số chiều tăng lên, dẫn đến các điểm dữ liệu có phân phối đều hơn trên khắp không gian dữ liệu. 

# Code

# Kết quả

# Thảo luận thêm


